services:
  grill-gauge-api:
    image: grill-gauge-api:latest
    container_name: grill-gauge-api
    ports:
      - "8080:8080"
    environment:
      - INT_CA_KEY_PASSPHRASE=${INT_CA_KEY_PASSPHRASE}
      - JWT_SECRET=${JWT_SECRET}
      - DB_PASSWORD=${DB_PASSWORD}
    volumes:
      - ~/intermediateCA:/app/CA:ro
    depends_on:
      - grill-gauge-db
    networks:
      - grill-gauge-network

  grill-gauge-ui:
    image: grill-gauge-ui:latest
    container_name: grill-gauge-ui
    ports:
      - "3000:3000"
    environment:
      # Public URL used by the browser
      - NEXT_PUBLIC_API_BASE_URL=http://localhost:8080/api/v1
      # Internal URL used by the Next.js server inside the container to reach the API
      - API_BASE_URL=http://grill-gauge-api:8080/api/v1
      - AUTH_SECRET=${AUTH_SECRET}
      - AUTH_GOOGLE_ID=${AUTH_GOOGLE_ID}
      - AUTH_GOOGLE_SECRET=${AUTH_GOOGLE_SECRET}
      - JWT_SECRET=${JWT_SECRET}
      - AUTH_TRUE_HOST=true
      - AUTH_URL=http://localhost:3000
      - DEV_WARNING_ENABLED=true
    depends_on:
      - grill-gauge-api
    networks:
      - grill-gauge-network

  grill-gauge-db:
    image: postgres:18
    container_name: grill-gauge-db
    environment:
      - POSTGRES_USER=grillgauge
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_DB=grillgauge
    ports:
      - "5432:5432"
    volumes:
      - ./grill-gauge-db-data:/var/lib/postgresql
    restart: unless-stopped
    networks:
      - grill-gauge-network

networks:
  grill-gauge-network:
    driver: bridge